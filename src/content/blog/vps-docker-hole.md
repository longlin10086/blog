---
author: longlin
pubDatetime: 2024-07-19T11:00:00Z
modDatetime: 2024-07-19T11:00:00Z
title: å›½å†…VPSè£…Dockerè¸©å‘å¯„å½•
slug: vps-docker-hole
featured: true
draft: false
tags:
  - Docker
  - VPS
description: æˆ‘çœŸè¦åè¡€ğŸ¥²
---

äº‹æƒ…èµ·å› æ˜¯è¿™æ ·çš„ï¼Œä¸ºäº†æ»¡è¶³æˆ‘å’Œå®¶äººæ—¥ç›Šå¢é•¿çš„å½±éŸ³éœ€æ±‚ï¼Œæˆ‘å†³å®šé‡‡ç”¨ Alist æŒ‚è½½äº‘ç›˜çš„æ–¹å¼å­˜æ”¾å½±éŸ³æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ç»‘å®šåŸŸåçš„æ–¹å¼æ–¹ä¾¿è®¿é—®ã€‚ç”±äºæˆ‘æœ¬äººæŒæœ‰å­˜å‚¨é‡æœ€å¤§çš„äº‘ç›˜æ˜¯å¤¸å…‹ç½‘ç›˜ï¼Œä¸”å¤¸å…‹ç½‘ç›˜æ”¯æŒç£åŠ›é“¾æ¥è½¬å­˜ï¼Œéå¸¸ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œå› æ­¤ä¸‹ä¸€æ­¥ä¾¿åªéœ€è¦æ‰¾ä¸€å°å¸¦å®½æ¯”è¾ƒå¤§çš„æœåŠ¡å™¨å°±è¡Œï¼ˆAlistæŒ‚å¤¸å…‹ç½‘ç›˜ä¸æ”¯æŒé‡å®šå‘ï¼Œåªæ”¯æŒæœ¬åœ°ä»£ç†ï¼‰ã€‚

![quark](@assets/images/vps-docker-hole/quark.png)

åœ¨æœ‹å‹æ¨èä¸‹æˆ‘ä¹°äº†ä¸€å° ä¸­å±± 200Må¸¦å®½ 500Gæµé‡ å¸¦v6å‡ºå…¥å£ æ­è½½ Ubt22.04 çš„VPSï¼Œå“¼å“§å“¼å“§çš„è¿ä¸Šå»ã€‚æ­¤æ—¶çš„æˆ‘è¿˜ä¸çŸ¥é“ï¼Œæˆ‘å®è´µçš„ä¸€æ™šä¸Šéƒ½å°†æµªè´¹åœ¨æ­¤ã€‚

é¦–å…ˆæ˜¯ apt å®˜æ–¹æºè®¿é—®ä¸æ˜¯å¾ˆå¥½ï¼Œä¸‹ä¸œè¥¿æ…¢ã€‚è¿™ä¸ªç®€å•ï¼Œåˆ° `/etc/apt/source.list` æ¢æºå˜›ï¼Œæˆ‘ç›´æ¥æ¢æˆæ¸…åæºã€‚

`nginx`å¾ˆå¿«å°±ä¸‹å¥½äº†ï¼Œç°åœ¨åˆ°äº†æœ€æ ¸å¿ƒçš„é—®é¢˜ï¼š`Docker`è¯¥æ€ä¹ˆä¸‹ï¼Ÿç”±äºæŸäº›åŸå› å›½å†…å‰ä¸ä¹…åˆšæŠŠ`Docker`å¢™äº†ï¼Œè¿™å¯¼è‡´å®˜ç½‘ç»™å‡ºçš„å®‰è£…æ­¥éª¤ä¼šå¡åœ¨è¿™ä¸€æ­¥ï¼š

```bash
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
```

å¥½ï¼Œæ—¢ç„¶ `source.list` èƒ½æ¢æºï¼Œè¿™é‡Œéš¾é“å°±ä¸èƒ½æ¢å—ï¼Ÿå¾ˆå¿«å•Šï¼Œä¸Šå’•å™œå’•å™œä¸€æœï¼Œç›¸ä¼¼çš„é—®é¢˜æœç„¶æœ‰å¾ˆå¤šï¼Œæœ€ååœ¨ `linux.do` è®ºå›ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å…·ä½“è¯¦æƒ…å¯è§ [è¿™ç¯‡åšå®¢çš„æœ«å°¾](https://www.wxy97.com/archives/77) ï¼Œå±äºæ˜¯å‰äººæ ½æ ‘åäººä¹˜å‡‰äº†ã€‚

~~`Docker` è£…ä¸Šäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯äº›æ”¶å°¾å·¥ä½œäº†ã€‚~~ å½“æˆ‘è¿è¡Œ `alist` `Docker`å®‰è£…è„šæœ¬çš„æ—¶å€™å‘ç°äº‹æƒ…æœ‰äº›ä¸å¯¹åŠ²äº†ï¼š

```bash
docker run -d --restart=unless-stopped -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name="alist" xhofe/alist:latest
```

è¢«å¢™äº†æ€ä¹ˆæ‹‰é•œåƒï¼Ÿï¼Ÿè¿™çœŸæ˜¯å¡å¤§å®¶è„–å­çš„å…³é”®æŠ€æœ¯ğŸ‘

æˆ‘æƒ³äº†ä¸¤ç§è§£å†³æ–¹æ³•ï¼š

1. ç›´æ¥åœ¨VPSä¸ŠæŒ‚ä»£ç†ç¿»
2. æœ¬åœ°ä¸‹è½½å¥½`image`åæ‰“åŒ…ç„¶å`scp`ä¸Šå»

å…ˆæ¥çœ‹ç¬¬ä¸€ç§æ–¹æ³•ï¼Œç”±äºæˆ‘è¿™æ˜¯VPSï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ”¯æŒWebè®¿é—®çš„ä»£ç†å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘æ‰¾äº†`daed`å’Œ`mihomo`ä¸¤æ¬¾è½¯ä»¶ã€‚åˆå› ä¸ºVPSæ— æ³•è®¿é—® `GitHub` ï¼Œæ‰€ä»¥æˆ‘è¿˜å¾—æŠŠç›¸å…³ Release åŒ…æ‰‹åŠ¨ä¸‹ä¸‹æ¥å`scp`ä¸Šå»ï¼Œéå¸¸éº»çƒ¦ã€‚

è¿™é‡Œå°±è¯´ç»“æœï¼š

1. `daed` è£…çš„å¾ˆå¿«ï¼Œä½†ç”±äºæˆ‘çš„æœºåœºè®¢é˜…é“¾æ¥è¢«å¢™æ‰€ä»¥æ— æ³•ä¸‹è½½ç›¸å…³é…ç½®ï¼Œå¯„ ~~ï¼ˆè¦ç”¨é­”æ³•æ¥æ‰“è´¥é­”æ³•ï¼‰~~
2. æ²¡çœ‹æ‡‚ `mihomo` è¦æ€æ ·å®‰è£…æ€æ ·è¿è¡Œæ€æ ·å¼€Webç«¯ï¼Œå¯„

é‚£ä¹ˆæ–¹æ³•åªå‰©æœ¬åœ°æ‰“åŒ…é•œåƒä¸Šä¼ äº†ï¼Œè¿™é‡Œæˆ‘åˆè¸©äº†ä¸ªå°å‘ã€‚

```bash
docker export [container-id] > ubuntu.tar
---
cat ubuntu.tar | docker import - test/ubuntu:v1.0
```

æˆ–

```bash
docker save -o alist_image.tar xhofe/alist:latest
---
docker load -i ./alist_image.tar
```

ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac ï¼Œæ‰“åŒ…é•œåƒä¸Šä¼ åå‘ç°è¿è¡Œä¸äº†ï¼Œçœ‹æŠ¥é”™æ‰å‘ç°æ˜¯å› ä¸ºæ¶æ„ä¸åŒã€‚

```bash
docker run -d --restart=unless-stopped -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name="alist" xhofe/alist:latest
WARNING: The requested image's platform (linux/arm64) does not match the detected host platform (linux/amd64/v4) and no specific platform was requested
```

å¥½å˜›ï¼Œè¿™ä¸‹åªèƒ½å¼€è™šæ‹Ÿæœºæˆ–æ˜¯ä»æˆ‘ hk çš„VPSä¸Šæ‰“åŒ…é•œåƒä¸Šä¼ äº†ï¼Œä½†æˆ‘å·²ç»ä¸æƒ³å†æŠ˜è…¾äº†ã€‚ã€‚ã€‚

ç­‰ç­‰ï¼Œ`alist`å¯ä»¥æ‰‹åŠ¨å®‰è£…å§ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦ç”¨`Docker`ï¼Œæˆ‘åªè¦æŠŠ`tar.gz`ä¸Šä¼ åæ‰‹åŠ¨è§£åŒ…å°±è¡Œäº†ã€‚ã€‚ã€‚

åé¢çš„äº‹å°±æ¯”è¾ƒç®€å•äº†ï¼ŒæŒ‰ç…§å®˜æ–¹æ­¥éª¤è§£åŒ…å®‰è£…ï¼Œé…`systemd`ï¼Œå†™å¥½`nginx.conf`ï¼Œæ‰“å¼€åä»£ï¼Œåˆ°`cloudflare`ä¸Šé…å¥½DNSï¼Œæ”¶å·¥ï¼

**æ‰€ä»¥æˆ‘åˆ°åº•è¯¥æ€ä¹ˆåœ¨å›½å†…VPSä¸Šè£…`Docker`é•œåƒå‘¢ï¼Ÿ**
